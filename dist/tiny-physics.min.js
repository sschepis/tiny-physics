(()=>{var y=class{constructor(t,s,i){this.x=t,this.y=s,this.z=i}add(t){return new y(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new y(this.x-t.x,this.y-t.y,this.z-t.z)}mul(t){return new y(this.x*t,this.y*t,this.z*t)}div(t){return new y(this.x/t,this.y/t,this.z/t)}mag(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}norm(){return this.div(this.mag())}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}static add(t,s){return t.add(s)}static sub(t,s){return t.sub(s)}static mul(t,s){return t.mul(s)}static div(t,s){return t.div(s)}static mag(t){return t.mag()}static norm(t){return t.norm()}static dot(t,s){return t.dot(s)}distance(t){return y.sub(this,t).mag()}static distance(t,s){return y.sub(t,s).mag()}static cross(t,s){return new y(t.y*s.z-t.z*s.y,t.z*s.x-t.x*s.z,t.x*s.y-t.y*s.x)}static angle(t,s){return Math.acos(y.dot(t,s)/(t.mag()*s.mag()))}static angleBetween(t,s){return Math.atan2(s.y-t.y,s.x-t.x)}static angleBetween3(t,s){return Math.atan2(s.y-t.y,s.x-t.x)}},u=class{constructor(t,s){this.x=t,this.y=s}add(t){return new u(this.x+t.x,this.y+t.y)}sub(t){return new u(this.x-t.x,this.y-t.y)}mul(t){return new u(this.x*t,this.y*t)}div(t){return new u(this.x/t,this.y/t)}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}norm(){return this.div(this.mag())}dot(t){return this.x*t.x+this.y*t.y}static add(t,s){return t.add(s)}static sub(t,s){return t.sub(s)}static mul(t,s){return t.mul(s)}static div(t,s){return t.div(s)}static mag(t){return t.mag()}static norm(t){return t.norm()}static dot(t,s){return t.dot(s)}distance(t){return u.sub(this,t).mag()}static distance(t,s){return u.sub(t,s).mag()}static cross(t,s){return t.x*s.y-t.y*s.x}static angle(t,s){return Math.acos(u.dot(t,s)/(t.mag()*s.mag()))}static angleBetween(t,s){return Math.atan2(s.y-t.y,s.x-t.x)}},T=class{constructor(t,s,i,a,h){this.world=t,this.vertices=s,this.indices=i,this.normals=a,this.uvs=h}},k=class extends PhysicsObject{constructor(t,s,i){super(t,i),this.mesh=s,this.opts=i,this.x=i.x||0,this.y=i.y||0,this.z=i.z||0,this.rx=i.rx||0,this.ry=i.ry||0,this.rz=i.rz||0,this.sx=i.sx||1,this.sy=i.sy||1,this.sz=i.sz||1}update(t){}draw(t,s){t.beginPath();for(let i=0;i<this.mesh.indices.length;i+=3){let a=this.mesh.indices[i],h=this.mesh.indices[i+1],c=this.mesh.indices[i+2],r=this.mesh.vertices[a],e=this.mesh.vertices[h],x=this.mesh.vertices[c],d=s.project(r.x,r.y,r.z),w=s.project(e.x,e.y,e.z),l=s.project(x.x,x.y,x.z);t.moveTo(d.x,d.y),t.lineTo(w.x,w.y),t.lineTo(l.x,l.y),t.lineTo(d.x,d.y)}t.stroke()}},v=class{constructor(t,s){this.world=t,this.objects=s||[]}addObject(t){this.objects.push(t)}update(){for(let t of this.objects)t.update(this.objects)}},p=class{constructor(t){this.opts=t,this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this.rx=t.rx||0,this.ry=t.ry||0,this.rz=t.rz||0}project(t,s,i){let a=this.rx*Math.PI/180,h=this.ry*Math.PI/180,c=this.rz*Math.PI/180,r=Math.cos,e=Math.sin,x=t-this.x,d=s-this.y,w=i-this.z,l=x,m=d*r(a)-w*e(a),o=d*e(a)+w*r(a),g=l*r(h)+o*e(h),z=m,P=-l*e(h)+o*r(h),U=g*r(c)-z*e(c),C=g*e(c)+z*r(c);return{x:U,y:C,z:P}}},S=class extends PhysicsEngine{scenes={};curScene="default";constructor(){super(),this.scenes[this.curScene]=new v(this),this.camera=new p({})}update(){super.update(),this.scenes[this.curScene].update()}draw(t){this.scenes[this.curScene].objects.forEach(s=>s.draw(t,this.camera))}addScene(t,s){this.scenes[t]=s}getScene(t){return this.scenes[t]}setScene(t){this.curScene=t}animate(t){this.update(),this.draw(t),requestAnimationFrame(()=>this.animate(t))}};window.Physics||(window.Physics={});window.Physics.DWorld=S;window.Physics.DObject=k;window.Physics.DScene=v;window.Physics.DCamera=p;window.Physics.DMesh=T;window.Physics.Vector2=u;window.Physics.Vector3=y;var f=class{engine;opts;constructor(t,s){this.engine=t,this.opts=s,this.x=s.x||0,this.y=s.y||0,this.vx=s.vx||0,this.vy=s.vy||0,this.ax=s.ax||0,this.ay=s.ay||0}update(t){this.vx+=this.ax,this.vy+=this.ay,this.x+=this.vx,this.y+=this.vy,this.ax=0,this.ay=0}draw(t){t.fillRect(this.x,this.y,10,10)}},q=class extends f{constructor(t,s){super(t,s),this.width=s.width||20,this.height=s.height||20,this.onSurface=!1}update(t){super.update(t),this.y+2*this.height>440&&(this.vy=0,this.onGround=!0)}},B=class extends f{constructor(t,s){super(t,s),this.width=s.width||100,this.height=s.height||10}draw(t){t.fillRect(this.x,this.y,this.width,this.height)}update(t){}},M=class{constructor(t,s){this.engine=t,this.opts=s}apply(t,s){}render(t){}},I=class{constructor(t){t=t||{},this.gravity=98,this.drag=0,this.forces=t.forces||[],this.objects=t.objects||[],t.animate&&t.animateCallback&&this.animate(this.objects,t.animateCallback.bind(this))}static createObject(t,s){return new t(this,s)}static createForce(t){return new M(this,t)}animate(t,s){this.onUpdate=s,this.objects=t||this.objects,this.lastTime=Date.now(),this.tick()}update(t,s){s||(s=this.objects||[]);for(let i=0;i<s.length;i++){let a=s[i];a.update&&a.update(s);for(let h=0;h<this.forces.length;h++)this.forces[h].apply(a,s,t);this.wrapBounds(a,{x:0,y:0,width:640,height:480})}}wrapBounds(t,s){t.x>s.x+s.width&&(t.x=s.x),t.x<s.x&&(t.x=s.x+s.width),t.y>s.y+s.height&&(t.y=s.y),t.y<s.y&&(t.y=s.y+s.height)}tick(){let t=Date.now(),s=(t-this.lastTime)/1e3;this.lastTime=t,this.update(s,this.objects),this.onUpdate&&(this.onUpdate(this.objects),setTimeout(this.tick.bind(this)),setTimeout(()=>this.tick.bind(this),10))}};function R(n){return{apply:function(t,s){var i=s.x-t.x,a=s.y-t.y,h=Math.sqrt(i*i+a*a);if(h>t.radius+s.radius){var c=n.force/(h*h);t.vx+=c*i/h,t.vy+=c*a/h,s.vx-=c*i/h,s.vy-=c*a/h}}}}function A(n){return{apply:function(t){t.vx*=1-n.drag,t.vy*=1-n.drag}}}function E(n){return{apply:function(t,s){var i=s.x-t.x,a=s.y-t.y,h=Math.sqrt(i*i+a*a);if(h<t.radius+s.radius){var c=n.force/(h*h);t.vx-=c*i/h,t.vy-=c*a/h,s.vx+=c*i/h,s.vy+=c*a/h}}}}function F(){return{apply:function(n,t){engine.wrapBounds(n,{x:0,y:0,width:canvas.width,height:canvas.height})}}}function G(n){return{apply:function(t,s){var i=s.x-t.x,a=s.y-t.y,h=Math.sqrt(i*i+a*a);if(h<t.radius+s.radius){var c=Math.atan2(a,i),r=Math.sin(c),e=Math.cos(c),x=0,d=0,w=i*e+a*r,l=a*e-i*r,m=t.vx*e+t.vy*r,o=t.vy*e-t.vx*r,g=s.vx*e+s.vy*r,z=s.vy*e-s.vx*r,P=m-g;m=((t.mass-s.mass)*m+2*s.mass*g)/(t.mass+s.mass),g=P+m,w=x+(t.radius+s.radius);var U=x*e-d*r,C=d*e+x*r,D=w*e-l*r,H=l*e+w*r;t.ax+=m*e-o*r,t.ay+=o*e+m*r,s.ax+=g*e-z*r,s.ay+=z*e+g*r}}}}window.Physics||(window.Physics={});window.Physics={PhysicsEngine:I,PhysicsObject:f,SolidObject:q,StaticObject:B,PhysicsForce:M,forces:{gravity:R,drag:A,repel:E,wrap:F,collision:G}};})();
//# sourceMappingURL=tiny-physics.min.js.map
